<html>
  <head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">

      <!-- Kamera-Rig mit custom Bewegung -->
      <a-entity id="rig" position="0 0 0" joystick-move>
        <a-entity camera look-controls position="0 1.6 0"></a-entity>
      </a-entity>

      <!-- Testobjekte -->
      <a-box position="0 0.5 -5" color="red" scale="5 1 1"></a-box>
      <a-plane rotation="-90 0 0" width="50" height="50" color="#7BC8A4"></a-plane>
      <a-sky color="#666666"></a-sky>

      <!-- Bewegung per Joystick -->
      <script>
        AFRAME.registerComponent('joystick-move', {
          schema: {
            speed: { type: 'number', default: 0.05 }
          },
          tick: function () {
            const rig = this.el;
            const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
            if (!gamepads || gamepads.length === 0) return;

            // Suche den Controller mit Achsen
            const gp = [...gamepads].find(gp => gp && gp.axes && gp.axes.length >= 4);
            if (!gp) return;

            const x = gp.axes[2]; // Seitlich (Strafen)
            const y = gp.axes[3]; // Vorwärts/Rückwärts

            if (Math.abs(x) < 0.1 && Math.abs(y) < 0.1) return; // Deadzone

            // Richtung der Kamera
            const direction = new THREE.Vector3();
            rig.sceneEl.camera.el.object3D.getWorldDirection(direction);
            direction.y = 0; // Nur horizontale Bewegung
            direction.normalize();

            // Aktuelle Position
            const pos = rig.getAttribute('position');

            // Bewegung
            pos.x += direction.x * -y * this.data.speed + x * this.data.speed;
            pos.z += direction.z * -y * this.data.speed - x * direction.x * 0.2;

            rig.setAttribute('position', pos);
          }
        });
      </script>

    </a-scene>
  </body>
</html>
